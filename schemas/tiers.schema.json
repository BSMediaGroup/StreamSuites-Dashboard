{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "StreamSuites Tier Policy",
  "description": "Defines feature access limits and allowances per subscription tier.",
  "type": "object",
  "additionalProperties": false,

  "required": ["version", "tiers"],

  "properties": {
    "version": {
      "type": "string",
      "description": "Tier policy version"
    },

    "tiers": {
      "type": "object",
      "description": "Map of tier identifiers to tier definitions",
      "minProperties": 1,
      "additionalProperties": {
        "$ref": "#/definitions/tier"
      }
    }
  },

  "definitions": {
    "tier": {
      "type": "object",
      "additionalProperties": false,
      "required": ["label", "description", "features"],

      "properties": {
        "label": {
          "type": "string",
          "minLength": 1
        },

        "description": {
          "type": "string",
          "minLength": 1
        },

        "features": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "triggers",
            "clips",
            "polls",
            "automation",
            "branding",
            "backups"
          ],

          "properties": {
            "triggers": {
              "$ref": "#/definitions/trigger_features"
            },
            "clips": {
              "$ref": "#/definitions/clip_features"
            },
            "polls": {
              "$ref": "#/definitions/poll_features"
            },
            "automation": {
              "$ref": "#/definitions/automation_features"
            },
            "branding": {
              "$ref": "#/definitions/branding_features"
            },
            "backups": {
              "$ref": "#/definitions/backup_features"
            }
          }
        }
      }
    },

    "trigger_features": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enabled", "max_triggers", "min_cooldown_seconds"],

      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "max_triggers": {
          "type": "integer",
          "minimum": 0
        },
        "min_cooldown_seconds": {
          "type": "number",
          "minimum": 0
        }
      }
    },

    "clip_features": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "enabled",
        "max_duration_seconds",
        "pre_roll_seconds",
        "min_cooldown_seconds",
        "max_concurrent_jobs"
      ],

      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "max_duration_seconds": {
          "type": "number",
          "minimum": 1
        },
        "pre_roll_seconds": {
          "type": "number",
          "minimum": 0
        },
        "min_cooldown_seconds": {
          "type": "number",
          "minimum": 0
        },
        "max_concurrent_jobs": {
          "type": "integer",
          "minimum": 0
        }
      }
    },

    "poll_features": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enabled", "max_active_polls", "max_options"],

      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "max_active_polls": {
          "type": "integer",
          "minimum": 0
        },
        "max_options": {
          "type": "integer",
          "minimum": 2
        }
      }
    },

    "automation_features": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enabled"],

      "properties": {
        "enabled": {
          "type": "boolean"
        }
      }
    },

    "branding_features": {
      "type": "object",
      "additionalProperties": false,
      "required": ["custom_bot_identity"],

      "properties": {
        "custom_bot_identity": {
          "type": "boolean"
        }
      }
    },

    "backup_features": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "manual_export",
        "automated_backups",
        "retention_days"
      ],

      "properties": {
        "manual_export": {
          "type": "boolean"
        },
        "automated_backups": {
          "type": "boolean"
        },
        "backup_interval_hours": {
          "type": "number",
          "minimum": 1
        },
        "retention_days": {
          "type": "integer",
          "minimum": 0
        }
      },

      "allOf": [
        {
          "if": {
            "properties": {
              "automated_backups": { "const": true }
            }
          },
          "then": {
            "required": ["backup_interval_hours"]
          }
        }
      ]
    }
  }
}
