<!-- ========================================================= -->
<!-- StreamSuites â€” Chat Triggers (VIEW PARTIAL) -->
<!-- NOTE: CSS and app bootstrap are loaded by index.html -->
<!-- ========================================================= -->

<!-- =========================================================
     HEADER
     ========================================================= -->
<header class="ss-header">
  <div class="ss-header-left">
    <h1 class="ss-title">StreamSuites</h1>
    <span class="ss-subtitle">Chat Triggers</span>
  </div>
</header>

<!-- =========================================================
     TOOLBAR
     ========================================================= -->
<section class="ss-toolbar">
  <div class="ss-toolbar-left">
    <button id="btn-add-trigger" class="ss-btn ss-btn-primary">
      + Add Trigger
    </button>

    <button id="btn-refresh-triggers" class="ss-btn ss-btn-secondary">
      Refresh
    </button>
  </div>

  <div class="ss-toolbar-right">
    <button id="btn-export-triggers" class="ss-btn ss-btn-secondary">
      Export JSON
    </button>

    <label class="ss-btn ss-btn-secondary ss-file-btn">
      Import JSON
      <input
        type="file"
        id="input-import-triggers"
        accept="application/json"
        hidden
      />
    </label>
  </div>
</section>

<!-- =========================================================
     ERROR MESSAGE
     ========================================================= -->
<div
  id="triggers-import-error"
  class="ss-alert ss-alert-danger hidden"
  style="margin: 0 1rem;"
>
  <span id="triggers-import-error-text"></span>
</div>

<!-- =========================================================
     TRIGGERS TABLE
     ========================================================= -->
<section class="ss-panel">
  <table class="ss-table">
    <thead>
      <tr>
        <th>Match</th>
        <th>Mode</th>
        <th>Response</th>
        <th>Cooldown</th>
        <th class="align-right">Actions</th>
      </tr>
    </thead>

    <tbody id="triggers-table-body">
      <!-- populated dynamically -->
    </tbody>
  </table>

  <div id="triggers-empty" class="ss-empty hidden">
    No triggers configured yet.
  </div>
</section>

<!-- =========================================================
     TRIGGER EDITOR
     ========================================================= -->
<section id="trigger-editor" class="ss-panel hidden">
  <header class="ss-panel-header">
    <h2 id="trigger-editor-title">Add Trigger</h2>
  </header>

  <div class="ss-panel-body">
    <form id="trigger-form" autocomplete="off">

      <div class="ss-form-row">
        <label for="trigger-match">Match Text</label>
        <input
          type="text"
          id="trigger-match"
          placeholder="e.g. !ping"
          required
        />
      </div>

      <div class="ss-form-row">
        <label for="trigger-match-mode">Match Mode</label>
        <select id="trigger-match-mode">
          <option value="equals_icase">
            Equals (case-insensitive)
          </option>
          <option value="contains_icase">
            Contains (case-insensitive)
          </option>
        </select>
      </div>

      <div class="ss-form-row">
        <label for="trigger-response">Response</label>
        <input
          type="text"
          id="trigger-response"
          placeholder="e.g. pong"
          required
        />
      </div>

      <div class="ss-form-row">
        <label for="trigger-cooldown">Cooldown (seconds)</label>
        <input
          type="number"
          id="trigger-cooldown"
          min="0"
          step="0.1"
          placeholder="0.75"
        />
      </div>

      <div class="ss-form-actions">
        <button type="submit" class="ss-btn ss-btn-primary">
          Save Trigger
        </button>

        <button
          type="button"
          id="btn-cancel-trigger"
          class="ss-btn ss-btn-secondary"
        >
          Cancel
        </button>
      </div>

    </form>
  </div>
</section>

<!-- =========================================================
     TRIGGER PIPELINES PLACEHOLDER
     ========================================================= -->
<section class="ss-panel" style="margin-top: 12px;">
  <header class="ss-panel-header">
    <h2>Trigger Pipelines</h2>
  </header>
  <div class="ss-panel-body">
    <p class="muted">
      Placeholder subsection for future trigger pipelines that can chain
      responses, scoring updates, or other runtime-owned actions. Mechanics are
      pending runtime design; this dashboard slot reserves navigation and copy
      only.
    </p>
    <ul class="ss-list muted">
      <li>Pipeline steps remain declarative and read-only within the dashboard.</li>
      <li>Execution, sequencing, and permissions are enforced by the runtime.</li>
      <li>Future alignment with scoreboard modules and trigger-driven tasks.</li>
    </ul>
  </div>
</section>

<!-- =========================================================
     FOOTER
     ========================================================= -->
<footer class="ss-footer">
  <span class="muted">
    Triggers affect live chat behaviour across supported platforms.
  </span>
</footer>

<!-- =========================================================
     VIEW-SCOPED IMPORT / EXPORT WIRING
     (triggers.js already loaded globally)
     ========================================================= -->
<script>
(function () {
  const btnExport = document.getElementById("btn-export-triggers");
  const fileInput = document.getElementById("input-import-triggers");

  const errorBox = document.getElementById("triggers-import-error");
  const errorText = document.getElementById("triggers-import-error-text");

  function showError(msg) {
    errorText.textContent = msg;
    errorBox.classList.remove("hidden");
  }

  function clearError() {
    errorBox.classList.add("hidden");
    errorText.textContent = "";
  }

  btnExport.addEventListener("click", () => {
    clearError();
    window.TriggersView?.exportTriggers();
  });

  fileInput.addEventListener("change", () => {
    clearError();
    const file = fileInput.files[0];
    if (!file) return;

    window.TriggersView?.importTriggersFromFile(file, showError);
    fileInput.value = "";
  });
})();
</script>
